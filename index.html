        // ì•± ì‹œì‘í•˜ê¸° ë²„íŠ¼
        function continueToApp() {
            authModal.style.display = 'none';
            document.getElementById('statusBar').textContent = 'ì¸ì¦ ì™„ë£Œ - YouTube Lens ì‚¬ìš© ì¤€ë¹„ë¨';
        }
        
        // í”Œë ˆì´ìŠ¤í™€ë” í•¨ìˆ˜ë“¤ (test.htmlì˜ ëª¨ë“  ê¸°ëŠ¥ë“¤)
        
        // ë¹„ë””ì˜¤ ëª¨ë‹¬ í‘œì‹œ
        function showVideoModal(videoId, videoTitle) {
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
            const existingModal = document.getElementById('videoModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // ëª¨ë‹¬ HTML ìƒì„±
            const modalHtml = `
                <div class="settings-modal" id="videoModal" style="display: block;">
                    <div class="settings-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
                        <button class="close-btn" onclick="closeVideoModal()">&times;</button>
                        <h3 style="margin-bottom: 20px; color: #2196F3;">ğŸ¬ ì˜ìƒ ì¬ìƒ</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <strong style="color: white; font-size: 16px;">ë¹„ë””ì˜¤ ì œëª©:</strong>
                            <div style="margin-top: 8px; padding: 12px; background: #2a2a2a; border-radius: 6px; color: #fff; font-size: 14px; line-height: 1.4;">${videoTitle}</div>
                        </div>
                        
                        <div style="margin-bottom: 20px; position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
                            <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 8px;" 
                                    src="https://www.youtube.com/embed/${videoId}" 
                                    allowfullscreen>
                            </iframe>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                            <button class="btn" onclick="window.open('https://www.youtube.com/watch?v=${videoId}', '_blank')" 
                                    style="background: #f44336; color: white; flex: 1; min-width: 120px;">ğŸ“º YouTube ì—´ê¸°</button>
                            <button class="btn" onclick="collectSubtitle('${videoId}')" 
                                    style="background: #4CAF50; color: white; flex: 1; min-width: 120px;">ğŸ¤ ìë§‰ìˆ˜ì§‘</button>
                            <button class="btn" onclick="closeVideoModal()" 
                                    style="background: #666; color: white; flex: 1; min-width: 100px;">âœ– ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // ë¹„ë””ì˜¤ ëª¨ë‹¬ ë‹«ê¸°
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ì„¤ëª… ëª¨ë‹¬ í‘œì‹œ
        function showDescriptionModal(videoId, videoTitle) {
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
            const existingModal = document.getElementById('descriptionModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // ì›ë³¸ ì„¤ëª… ê°€ì ¸ì˜¤ê¸°
            let originalDescription = videoDescriptions[videoId] || '';
            
            // ìµœì¢… í…ìŠ¤íŠ¸ ì •ë¦¬
            let finalText = originalDescription
                .replace(/&nbsp;/g, ' ')         // HTML ì—”í‹°í‹° ì œê±°
                .replace(/&amp;/g, '&')          // &amp; ì—”í‹°í‹° ì œê±°
                .replace(/&lt;/g, '<')           // &lt; ì—”í‹°í‹° ì œê±°
                .replace(/&gt;/g, '>')           // &gt; ì—”í‹°í‹° ì œê±°
                .replace(/&quot;/g, '"')         // &quot; ì—”í‹°í‹° ì œê±°
                .replace(/\r\n/g, '\n')          // Windows ì¤„ë°”ê¿ˆì„ Unix í˜•ì‹ìœ¼ë¡œ í†µì¼
                .replace(/\r/g, '\n')            // Mac ì¤„ë°”ê¿ˆì„ Unix í˜•ì‹ìœ¼ë¡œ í†µì¼
                .replace(/ +/g, ' ')             // ì—°ì†ëœ ê³µë°±ì„ í•˜ë‚˜ë¡œ ì¤„ì„ (ì¤„ë°”ê¿ˆì€ ë³´ì¡´)
                .replace(/^\s+|\s+$/g, '')       // ì•ë’¤ ê³µë°±ë§Œ ì œê±°
            
            // ëª¨ë‹¬ ìƒì„±
            const modal = document.createElement('div');
            modal.id = 'descriptionModal';
            modal.className = 'settings-modal';
            modal.style.display = 'block';
            
            const content = document.createElement('div');
            content.className = 'settings-content';
            content.style.cssText = `
                max-width: 700px;
                max-height: 80vh;
                overflow: hidden;
                background: #D2E9E1;
                padding: 0;
                border-radius: 12px;
            `;
            
            // í—¤ë” ìƒì„±
            const header = document.createElement('div');
            header.style.cssText = `
                padding: 12px 15px 8px 15px;
                border-bottom: 1px solid #ccc;
                background: #D2E9E1;
                position: relative;
            `;
            
            const closeBtn = document.createElement('button');
            closeBtn.className = 'close-btn';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = () => modal.remove();
            
            const title = document.createElement('h3');
            title.textContent = 'ğŸ“ ì˜ìƒ ì„¤ëª…';
            title.style.cssText = `
                margin: 0;
                color: #1A365D;
                font-size: 16px;
                font-weight: bold;
            `;
            
            const videoTitleDiv = document.createElement('div');
            videoTitleDiv.textContent = videoTitle;
            videoTitleDiv.style.cssText = `
                margin-top: 5px;
                font-size: 12px;
                color: #666;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            `;
            
            header.appendChild(closeBtn);
            header.appendChild(title);
            header.appendChild(videoTitleDiv);
            
            // ë‚´ìš© ì˜ì—­ ìƒì„±
            const contentArea = document.createElement('div');
            contentArea.style.cssText = `
                max-height: 400px;
                overflow-y: auto;
                background: #D2E9E1;
                padding: 10px;
            `;
            
            if (finalText) {
                const textBox = document.createElement('div');
                textBox.style.cssText = `
                    background: white;
                    border-radius: 6px;
                    padding: 8px;
                    color: black;
                    font-size: 14px;
                    line-height: 1.5;
                    word-wrap: break-word;
                    white-space: pre-wrap;
                    margin: 0;
                `;
                textBox.textContent = finalText;
                contentArea.appendChild(textBox);
            } else {
                const noDesc = document.createElement('div');
                noDesc.style.cssText = `
                    text-align: center;
                    padding: 40px;
                    color: #666;
                `;
                noDesc.innerHTML = `
                    <div style="font-size: 16px; margin-bottom: 8px;">ğŸ“</div>
                    <div>ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.</div>
                `;
                contentArea.appendChild(noDesc);
            }
            
            // ë²„íŠ¼ ì˜ì—­ ìƒì„±
            const buttonArea = document.createElement('div');
            buttonArea.style.cssText = `
                padding: 8px 15px;
                border-top: 1px solid #ccc;
                background: #D2E9E1;
                display: flex;
                gap: 8px;
                justify-content: center;
            `;
            
            if (finalText) {
                const copyBtn = document.createElement('button');
                copyBtn.textContent = 'ì„¤ëª…ë³µì‚¬';
                copyBtn.style.cssText = `
                    background: #FF9800;
                    color: white;
                    border: none;
                    border-radius: 5px;
                    padding: 6px 12px;
                    font-weight: bold;
                    cursor: pointer;
                    width: 80px;
                    font-size: 12px;
                `;
                copyBtn.onclick = () => {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(finalText).then(() => {
                            copyBtn.textContent = 'ë³µì‚¬ì™„ë£Œ';
                            setTimeout(() => copyBtn.textContent = 'ì„¤ëª…ë³µì‚¬', 1500);
                        });
                    } else {
                        const textarea = document.createElement('textarea');
                        textarea.value = finalText;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        copyBtn.textContent = 'ë³µì‚¬ì™„ë£Œ';
                        setTimeout(() => copyBtn.textContent = 'ì„¤ëª…ë³µì‚¬', 1500);
                    }
                };
                buttonArea.appendChild(copyBtn);
            }
            
            const closeButton = document.createElement('button');
            closeButton.textContent = 'ë‹«ê¸°';
            closeButton.style.cssText = `
                background: #4a9eff;
                color: white;
                border: none;
                border-radius: 5px;
                padding: 6px 12px;
                font-weight: bold;
                cursor: pointer;
                width: 80px;
                font-size: 12px;
            `;
            closeButton.onclick = () => modal.remove();
            buttonArea.appendChild(closeButton);
            
            // ëª¨ë‹¬ ì¡°ë¦½
            content.appendChild(header);
            content.appendChild(contentArea);
            content.appendChild(buttonArea);
            modal.appendChild(content);
            
            // ì™¸ë¶€ í´ë¦­ ì´ë²¤íŠ¸
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }
        
        // ëŒ“ê¸€ ëª¨ë‹¬ í‘œì‹œ
        async function showCommentsModal(videoId, videoTitle) {
            if (apiKeys.length === 0) {
                alert('API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.');
                return;
            }
            
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
            const existingModal = document.getElementById('commentsModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            try {
                // ë°±ì—”ë“œì—ì„œ ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸°
                const result = await callBackendAPI('comments', { 
                    videoId: videoId,
                    maxResults: 20
                });
                
                const comments = result.data || [];
                let commentsHtml = '';
                
                if (comments.length === 0) {
                    commentsHtml = '<div style="text-align: center; padding: 20px; color: #666;">ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</div>';
                } else {
                    commentsHtml = comments.map((item, index) => {
                        const comment = item.snippet.topLevelComment.snippet;
                        return `
                            <div style="padding: 10px; border-bottom: 1px solid #eee; background: ${index % 2 === 0 ? '#f9f9f9' : 'white'};">
                                <div style="display: flex; align-items: flex-start; gap: 8px;">
                                    <img src="${comment.authorProfileImageUrl}" style="width: 32px; height: 32px; border-radius: 50%;" onerror="this.style.display='none'">
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold; color: #1976d2; font-size: 12px; margin-bottom: 4px;">${comment.authorDisplayName}</div>
                                        <div style="color: #333; font-size: 13px; line-height: 1.4; word-wrap: break-word;">${comment.textDisplay}</div>
                                        <div style="color: #666; font-size: 11px; margin-top: 4px;">ğŸ‘ ${comment.likeCount} â€¢ ${new Date(comment.publishedAt).toLocaleDateString()}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                const modalHtml = `
                    <div class="settings-modal" id="commentsModal" style="display: block;">
                        <div class="settings-content" style="max-width: 700px; max-height: 80vh; overflow: hidden; background: white; padding: 0; border-radius: 12px;">
                            <button class="close-btn" onclick="closeCommentsModal()" style="background: #f44336; border-color: #f44336;">&times;</button>
                            <div style="padding: 15px 20px; border-bottom: 1px solid #ddd; background: #f5f5f5;">
                                <h3 style="margin: 0; color: #333; font-size: 16px;">ğŸ’¬ ë² ìŠ¤íŠ¸ ëŒ“ê¸€</h3>
                                <div style="margin-top: 5px; font-size: 12px; color: #666; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${videoTitle}</div>
                            </div>
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${commentsHtml}
                            </div>
                            <div style="padding: 10px 20px; background: #f5f5f5; display: flex; gap: 10px; justify-content: center;">
                                <button onclick="copyAllComments()" style="background: #4caf50; color: white; border: none; border-radius: 5px; padding: 8px 16px; font-weight: bold; cursor: pointer;">ëª¨ë“  ëŒ“ê¸€ ë³µì‚¬</button>
                                <button onclick="closeCommentsModal()" style="background: #666; color: white; border: none; border-radius: 5px; padding: 8px 16px; font-weight: bold; cursor: pointer;">ë‹«ê¸°</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                
                // ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
                document.getElementById('commentsModal').addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeCommentsModal();
                    }
                });
                
            } catch (error) {
                console.error('ëŒ“ê¸€ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                alert('ëŒ“ê¸€ì„ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }
        
        // ëª¨ë“  ëŒ“ê¸€ ë³µì‚¬
        function copyAllComments() {
            const commentsModal = document.getElementById('commentsModal');
            if (!commentsModal) return;
            
            const commentDivs = commentsModal.querySelectorAll('div[style*="word-wrap: break-word"]');
            let allComments = '';
            
            commentDivs.forEach((div, index) => {
                const commentText = div.textContent.trim();
                if (commentText) {
                    allComments += `${index + 1}. ${commentText}\n\n`;
                }
            });
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(allComments).then(() => {
                    const copyBtn = commentsModal.querySelector('button[onclick="copyAllComments()"]');
                    if (copyBtn) {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = 'ë³µì‚¬ì™„ë£Œ';
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                        }, 1500);
                    }
                }).catch(err => {
                    console.error('ëŒ“ê¸€ ë³µì‚¬ ì‹¤íŒ¨:', err);
                    fallbackCopyComments(allComments);
                });
            } else {
                fallbackCopyComments(allComments);
            }
        }
        
        function fallbackCopyComments(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    const commentsModal = document.getElementById('commentsModal');
                    const copyBtn = commentsModal?.querySelector('button[onclick="copyAllComments()"]');
                    if (copyBtn) {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = 'ë³µì‚¬ì™„ë£Œ';
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                        }, 1500);
                    }
                }
            } catch (err) {
                console.error('Fallback í´ë¦½ë³´ë“œ ë³µì‚¬ ì‹¤íŒ¨:', err);
                alert('í´ë¦½ë³´ë“œ ë³µì‚¬ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            }
            
            document.body.removeChild(textArea);
        }
        
        // ëŒ“ê¸€ ëª¨ë‹¬ ë‹«ê¸°
        function closeCommentsModal() {
            const modal = document.getElementById('commentsModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ìƒì„¸ ì±„ë„ ì •ë³´ í‘œì‹œ
        async function showDetailedChannelInfo(channelId, channelName) {
            if (!channelId) {
                alert('ì±„ë„ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            if (apiKeys.length === 0) {
                alert('ë¨¼ì € YouTube API í‚¤ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.');
                openSettings();
                return;
            }
            
            try {
                // ë¡œë”© ìƒíƒœ í‘œì‹œ
                document.getElementById('statusBar').textContent = `ì±„ë„ ì •ë³´ ê°€ì ¸ì˜¤ëŠ” ì¤‘... (${channelName})`;
                
                // ë°±ì—”ë“œì—ì„œ ì±„ë„ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                const result = await callBackendAPI('channel-details', { channelId: channelId });
                
                if (!result.data) {
                    alert('ì±„ë„ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }
                
                // ì±„ë„ ì •ë³´ ëª¨ë‹¬ í‘œì‹œ
                showDetailedChannelModal(result.data);
                document.getElementById('statusBar').textContent = 'ì±„ë„ ì •ë³´ ë¡œë“œ ì™„ë£Œ';
                
            } catch (error) {
                console.error('ì±„ë„ ì •ë³´ ê°€ì ¸ì˜¤ê¸° ì˜¤ë¥˜:', error);
                alert('ì±„ë„ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                document.getElementById('statusBar').textContent = 'ì±„ë„ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨';
            }
        }
        
        // ìƒì„¸ ì±„ë„ ëª¨ë‹¬ í‘œì‹œ
        function showDetailedChannelModal(channelData) {
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
            const existingModal = document.getElementById('detailedChannelModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const snippet = channelData.snippet;
            const statistics = channelData.statistics;
            const contentDetails = channelData.contentDetails;
            
            const channelId = channelData.id;
            const channelTitle = snippet.title;
            const thumbnailUrl = snippet.thumbnails.high?.url || snippet.thumbnails.default?.url || '';
            const publishedAt = snippet.publishedAt;
            const description = snippet.description || '';
            const customUrl = snippet.customUrl || '';
            const country = snippet.country || 'Unknown';
            
            const subscriberCount = parseInt(statistics.subscriberCount || 0);
            const videoCount = parseInt(statistics.videoCount || 0);
            const viewCount = parseInt(statistics.viewCount || 0);
            
            const uploadsPlaylistId = contentDetails?.relatedPlaylists?.uploads || '';
            
            // êµ­ê°€ëª… ë§¤í•‘
            const countryNames = {
                'KR': 'ëŒ€í•œë¯¼êµ­', 'US': 'ë¯¸êµ­', 'JP': 'ì¼ë³¸', 'CN': 'ì¤‘êµ­', 'GB': 'ì˜êµ­',
                'DE': 'ë…ì¼', 'FR': 'í”„ë‘ìŠ¤', 'CA': 'ìºë‚˜ë‹¤', 'AU': 'í˜¸ì£¼', 'IN': 'ì¸ë„',
                'BR': 'ë¸Œë¼ì§ˆ', 'MX': 'ë©•ì‹œì½”', 'IT': 'ì´íƒˆë¦¬ì•„', 'ES': 'ìŠ¤í˜ì¸',
                'RU': 'ëŸ¬ì‹œì•„', 'NL': 'ë„¤ëœë€ë“œ', 'SE': 'ìŠ¤ì›¨ë´', 'NO': 'ë…¸ë¥´ì›¨ì´',
                'DK': 'ë´ë§ˆí¬', 'FI': 'í•€ë€ë“œ', 'TH': 'íƒœêµ­', 'VN': 'ë² íŠ¸ë‚¨',
                'SG': 'ì‹±ê°€í¬ë¥´', 'MY': 'ë§ë ˆì´ì‹œì•„', 'ID': 'ì¸ë„ë„¤ì‹œì•„', 'PH': 'í•„ë¦¬í•€',
                'TW': 'ëŒ€ë§Œ', 'HK': 'í™ì½©', 'Unknown': 'ì•Œ ìˆ˜ ì—†ìŒ'
            };
            const countryName = countryNames[country] || country;
            
            // ê³„ì‚°ëœ ì§€í‘œë“¤
            const avgViewsPerVideo = videoCount > 0 ? Math.round(viewCount / videoCount) : 0;
            
            // ìƒì„¸ í†µê³„ ì •ë³´ HTML ìƒì„±
            const statsInfoHtml = `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px;">
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">${subscriberCount.toLocaleString()}ëª…</div>
                        <div style="font-size: 10px; color: #666;">êµ¬ë…ì ìˆ˜</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">${videoCount.toLocaleString()}ê°œ</div>
                        <div style="font-size: 10px; color: #666;">ì´ ì˜ìƒ ìˆ˜</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">2025. 4. 4.</div>
                        <div style="font-size: 10px; color: #666;">ë§ˆì§€ë§‰ ì—…ë¡œë“œ</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">${viewCount.toLocaleString()}íšŒ</div>
                        <div style="font-size: 10px; color: #666;">ì´ ì¡°íšŒìˆ˜</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">${avgViewsPerVideo.toLocaleString()}íšŒ</div>
                        <div style="font-size: 10px; color: #666;">í‰ê·  ì¡°íšŒìˆ˜</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">340ê°œ</div>
                        <div style="font-size: 10px; color: #666;">í‰ê·  ì¢‹ì•„ìš”</div>
                    </div>
                </div>
            `;
            
            const modalHtml = `
                <div class="settings-modal" id="detailedChannelModal" style="display: block;">
                    <div class="settings-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto; background: #D2E9E1;">
                        <button class="close-btn" onclick="closeDetailedChannelModal()">&times;</button>
                        
                        <!-- ì±„ë„ ì´ë¯¸ì§€ì™€ ê¸°ë³¸ ì •ë³´ -->
                        <div style="text-align: center; margin-bottom: 15px;">
                            <img src="${thumbnailUrl}" alt="ì±„ë„ ì¸ë„¤ì¼" 
                                 onclick="window.open('https://www.youtube.com/channel/${channelId}', '_blank')" 
                                 style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; cursor: pointer; margin-bottom: 10px;">
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div style="flex: 2;"></div>
                                <h3 onclick="window.open('https://www.youtube.com/channel/${channelId}', '_blank')" 
                                    style="flex: 4; color: #4a9eff; font-size: 20px; font-weight: bold; margin: 0; cursor: pointer; text-align: center;">
                                    ${channelTitle}
                                </h3>
                                <div style="flex: 2; text-align: right; font-size: 12px; color: #666;">
                                    <div>êµ­ê°€: ${countryName}</div>
                                    <div>ê°œì„¤ì¼: ${new Date(publishedAt).getFullYear()}. ${(new Date(publishedAt).getMonth() + 1)}. ${new Date(publishedAt).getDate()}.</div>
                                </div>
                            </div>
                        </div>
                        
                        ${statsInfoHtml}
                        
                        <!-- ì±„ë„ ì„¤ëª… -->
                        <div style="background: rgba(255,255,255,0.9); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                            <h4 style="color: #1A365D; margin: 0 0 8px 0; font-size: 14px; font-weight: bold;">ì±„ë„ ì„¤ëª…</h4>
                            <div style="color: #4A5568; font-size: 12px; line-height: 1.4; max-height: 60px; overflow-y: auto;">
                                ${description || 'ì±„ë„ ì„¤ëª…ì´ ì—†ìŠµë‹ˆë‹¤.'}
                            </div>
                        </div>
                        
                        <!-- ë²„íŠ¼ ì˜ì—­ -->
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button onclick="collectChannelVideosFromModal('${channelId}', '${channelTitle.replace(/'/g, "&apos;")}', '${uploadsPlaylistId}')" 
                                    style="background: #4CAF50; color: white; border: none; border-radius: 5px; width: 120px; height: 35px; font-weight: bold; cursor: pointer;">
                                ì±„ë„ ì˜ìƒ ìˆ˜ì§‘
                            </button>
                            <button onclick="closeDetailedChannelModal()" 
                                    style="background: #4a9eff; color: white; border: none; border-radius: 5px; width: 120px; height: 35px; font-weight: bold; cursor: pointer;">
                                ë‹«ê¸°
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // ìƒì„¸ ì±„ë„ ëª¨ë‹¬ì—ì„œ ì±„ë„ ì˜ìƒ ìˆ˜ì§‘
        async function collectChannelVideosFromModal(channelId, channelTitle, uploadPlaylist) {
            try {
                // ëª¨ë‹¬ ë‹«ê¸°
                closeDetailedChannelModal();
                
                // ë¡œë”© í‘œì‹œ
                showLoading(true);
                document.getElementById('statusBar').textContent = `ì±„ë„ ì˜ìƒ ìˆ˜ì§‘ ì¤‘... (${channelTitle})`;
                
                // ì˜ìƒ ìˆ˜ì§‘ ìˆ˜ ê°€ì ¸ì˜¤ê¸°
                const maxResults = document.getElementById('maxResults').value;
                
                // ë°±ì—”ë“œì—ì„œ ì±„ë„ ì˜ìƒ ê°€ì ¸ì˜¤ê¸°
                const result = await callBackendAPI('channel-videos', { 
                    channelId: channelId,
                    uploadsPlaylistId: uploadPlaylist,
                    maxResults: parseInt(maxResults)
                });
                
                if (result.data.length === 0) {
                    alert('ì´ ì±„ë„ì—ì„œ ì˜ìƒì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                    showLoading(false);
                    return;
                }
                
                // ê²°ê³¼ í‘œì‹œ
                originalResults = result.data;
                currentResults = [...originalResults];
                displayResults(currentResults);
                document.getElementById('statusBar').textContent = `ì±„ë„ ì˜ìƒ ìˆ˜ì§‘ ì™„ë£Œ - ${result.data.length}ê°œ ì˜ìƒ`;
                
            } catch (error) {
                console.error('ì±„ë„ ì˜ìƒ ìˆ˜ì§‘ ì˜¤ë¥˜:', error);
                alert('ì±„ë„ ì˜ìƒì„ ìˆ˜ì§‘í•˜ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                document.getElementById('statusBar').textContent = 'ì±„ë„ ì˜ìƒ ìˆ˜ì§‘ ì‹¤íŒ¨';
                showLoading(false);
            }
        }
        
        // ìƒì„¸ ì±„ë„ ëª¨ë‹¬ ë‹«ê¸°
        function closeDetailedChannelModal() {
            const modal = document.getElementById('detailedChannelModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ìë§‰ ìˆ˜ì§‘ ê¸°ëŠ¥
        async function collectSubtitle(videoId) {
            if (!videoId) {
                alert('ë¹„ë””ì˜¤ IDê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }
            
            try {
                // ë¡œë”© í‘œì‹œ
                const statusBar = document.getElementById('statusBar');
                statusBar.textContent = `ìë§‰ ìˆ˜ì§‘ ì¤‘... (${videoId})`;
                
                // ë¬´ë£Œ APIë¡œ ìë§‰ ìˆ˜ì§‘
                const response = await fetch(`https://youtube-subtitle-api-omega.vercel.app/api/test?videoId=${videoId}`);
                const data = await response.json();
                
                if (data.error) {
                    alert('ìë§‰ ìˆ˜ì§‘ ì˜¤ë¥˜: ' + data.error);
                    statusBar.textContent = 'ìë§‰ ìˆ˜ì§‘ ì‹¤íŒ¨';
                    return;
                }
                
                // ê²°ê³¼ í‘œì‹œ
                showSubtitleModal(data);
                statusBar.textContent = 'ìë§‰ ìˆ˜ì§‘ ì™„ë£Œ';
                
            } catch (error) {
                console.error('ìë§‰ ìˆ˜ì§‘ ì˜¤ë¥˜:', error);
                alert('ìë§‰ ìˆ˜ì§‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
                document.getElementById('statusBar').textContent = 'ìë§‰ ìˆ˜ì§‘ ì‹¤íŒ¨';
            }
        }
        
        // ìë§‰ ê²°ê³¼ ëª¨ë‹¬ í‘œì‹œ
        function showSubtitleModal(data) {
            // í˜„ì¬ ë¹„ë””ì˜¤ ID ì €ì¥
            currentVideoId = data.videoId;
            
            // ê¸°ì¡´ ëª¨ë‹¬ ì œê±°
            const existingModal = document.getElementById('subtitleModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // ëª¨ë‹¬ HTML ìƒì„±
            const modalHtml = `
                <div class="settings-modal" id="subtitleModal" style="display: block;">
                    <div class="settings-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
                        <button class="close-btn" onclick="closeSubtitleModal()">&times;</button>
                        <h3 style="margin-bottom: 20px; color: #2196F3;">ğŸ¤ ìë§‰ ìˆ˜ì§‘ ì™„ë£Œ!</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <strong style="color: white; font-size: 16px;">ë¹„ë””ì˜¤ ì œëª©:</strong>
                            <div style="margin-top: 8px; padding: 12px; background: #2a2a2a; border-radius: 6px; color: #fff; font-size: 14px; line-height: 1.4;">${data.videoTitle || data.videoId}</div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: white; font-size: 16px; margin-bottom: 8px; display: block;">ìë§‰ ë‚´ìš©:</strong>
                            <textarea readonly id="subtitleTextArea" style="width: 100%; height: 400px; padding: 12px; border: 1px solid #555; border-radius: 6px; background: #1a1a1a; color: white; font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 13px; resize: vertical; line-height: 1.4;">${data.subtitle || 'ìë§‰ì´ ì—†ìŠµë‹ˆë‹¤.'}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="copySubtitle()" style="flex: 1; min-width: 120px;">ğŸ“‹ ìë§‰ ë³µì‚¬</button>
                            <button class="btn" onclick="downloadSubtitle()" style="background: #FF9800; color: white; flex: 1; min-width: 120px;">ğŸ“¥ TXT ë‹¤ìš´ë¡œë“œ</button>
                            <button class="btn" onclick="openYouTubeVideo()" style="background: #f44336; color: white; flex: 1; min-width: 120px;">ğŸ“º YouTube ì—´ê¸°</button>
                            <button class="btn" onclick="closeSubtitleModal()" style="background: #666; color: white; flex: 1; min-width: 100px;">âœ– ë‹«ê¸°</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // ìë§‰ ë³µì‚¬
        function copySubtitle() {
            const textArea = document.getElementById('subtitleTextArea');
            if (textArea) {
                textArea.select();
                document.execCommand('copy');
                alert('ìë§‰ì´ í´ë¦½ë³´ë“œì— ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
            }
        }
        
        // ìë§‰ ë‹¤ìš´ë¡œë“œ
        function downloadSubtitle() {
            const textArea = document.getElementById('subtitleTextArea');
            if (textArea) {
                const blob = new Blob([textArea.value], { type: 'text/plain;charset=utf-8' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `subtitle_${currentVideoId}.txt`;
                link.click();
            }
        }
        
        // YouTube ì˜ìƒ ì—´ê¸°
        function openYouTubeVideo() {
            if (currentVideoId) {
                window.open(`https://www.youtube.com/watch?v=${currentVideoId}`, '_blank');
            }
        }
        
        // ìë§‰ ëª¨ë‹¬ ë‹«ê¸°
        function closeSubtitleModal() {
            const modal = document.getElementById('subtitleModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // ì´ˆê¸°í™” (test.htmlì—ì„œ ë³µì‚¬í•˜ê³  index.htmlì˜ ì¸ì¦ ì´ˆê¸°í™” ì¶”ê°€)
        document.addEventListener('DOMContentLoaded', async function() {
            // ì¸ì¦ ì‹œìŠ¤í…œ ì´ˆê¸°í™”
            await initializeAuth();
            
            // ì €ì¥ëœ API í‚¤ ë¡œë“œ
            const savedApiKeys = localStorage.getItem('youtubeApiKeys');
            if (savedApiKeys) {
                apiKeys = JSON.parse(savedApiKeys);
            }
            
            // ì˜¤ëŠ˜ ë‚ ì§œ ì„¤ì •
            const today = new Date().toLocaleDateString('sv-SE', {timeZone: 'Asia/Seoul'});
            const endDateField = document.getElementById('endDate');
            const startDateField = document.getElementById('startDate');
            
            endDateField.value = today;
            endDateField.max = today;
            startDateField.max = today;
            
            // 1ê°œì›” ì „ ë‚ ì§œ ì„¤ì •
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            const startDateStr = oneMonthAgo.toLocaleDateString('sv-SE', {timeZone: 'Asia/Seoul'});
            startDateField.value = startDateStr;
            
            updateDateLimits();
        });
        
        // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸš€ YouTube Lens ì‹œì‘');
            initializeAuth();
        });
    </script>
</body>
</html>
