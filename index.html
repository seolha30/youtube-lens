        // 앱 시작하기 버튼
        function continueToApp() {
            authModal.style.display = 'none';
            document.getElementById('statusBar').textContent = '인증 완료 - YouTube Lens 사용 준비됨';
        }
        
        // 플레이스홀더 함수들 (test.html의 모든 기능들)
        
        // 비디오 모달 표시
        function showVideoModal(videoId, videoTitle) {
            // 기존 모달 제거
            const existingModal = document.getElementById('videoModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 모달 HTML 생성
            const modalHtml = `
                <div class="settings-modal" id="videoModal" style="display: block;">
                    <div class="settings-content" style="max-width: 1000px; max-height: 90vh; overflow-y: auto;">
                        <button class="close-btn" onclick="closeVideoModal()">&times;</button>
                        <h3 style="margin-bottom: 20px; color: #2196F3;">🎬 영상 재생</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <strong style="color: white; font-size: 16px;">비디오 제목:</strong>
                            <div style="margin-top: 8px; padding: 12px; background: #2a2a2a; border-radius: 6px; color: #fff; font-size: 14px; line-height: 1.4;">${videoTitle}</div>
                        </div>
                        
                        <div style="margin-bottom: 20px; position: relative; padding-bottom: 56.25%; height: 0; overflow: hidden;">
                            <iframe style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; border: none; border-radius: 8px;" 
                                    src="https://www.youtube.com/embed/${videoId}" 
                                    allowfullscreen>
                            </iframe>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                            <button class="btn" onclick="window.open('https://www.youtube.com/watch?v=${videoId}', '_blank')" 
                                    style="background: #f44336; color: white; flex: 1; min-width: 120px;">📺 YouTube 열기</button>
                            <button class="btn" onclick="collectSubtitle('${videoId}')" 
                                    style="background: #4CAF50; color: white; flex: 1; min-width: 120px;">🎤 자막수집</button>
                            <button class="btn" onclick="closeVideoModal()" 
                                    style="background: #666; color: white; flex: 1; min-width: 100px;">✖ 닫기</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // 비디오 모달 닫기
        function closeVideoModal() {
            const modal = document.getElementById('videoModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // 설명 모달 표시
        function showDescriptionModal(videoId, videoTitle) {
            // 기존 모달 제거
            const existingModal = document.getElementById('descriptionModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 원본 설명 가져오기
            let originalDescription = videoDescriptions[videoId] || '';
            
            // 최종 텍스트 정리
            let finalText = originalDescription
                .replace(/&nbsp;/g, ' ')         // HTML 엔티티 제거
                .replace(/&amp;/g, '&')          // &amp; 엔티티 제거
                .replace(/&lt;/g, '<')           // &lt; 엔티티 제거
                .replace(/&gt;/g, '>')           // &gt; 엔티티 제거
                .replace(/&quot;/g, '"')         // &quot; 엔티티 제거
                .replace(/\r\n/g, '\n')          // Windows 줄바꿈을 Unix 형식으로 통일
                .replace(/\r/g, '\n')            // Mac 줄바꿈을 Unix 형식으로 통일
                .replace(/ +/g, ' ')             // 연속된 공백을 하나로 줄임 (줄바꿈은 보존)
                .replace(/^\s+|\s+$/g, '')       // 앞뒤 공백만 제거
            
            // 모달 생성
            const modal = document.createElement('div');
            modal.id = 'descriptionModal';
            modal.className = 'settings-modal';
            modal.style.display = 'block';
            
            const content = document.createElement('div');
            content.className = 'settings-content';
            content.style.cssText = `
                max-width: 700px;
                max-height: 80vh;
                overflow: hidden;
                background: #D2E9E1;
                padding: 0;
                border-radius: 12px;
            `;
            
            // 헤더 생성
            const header = document.createElement('div');
            header.style.cssText = `
                padding: 12px 15px 8px 15px;
                border-bottom: 1px solid #ccc;
                background: #D2E9E1;
                position: relative;
            `;
            
            const closeBtn = document.createElement('button');
            closeBtn.className = 'close-btn';
            closeBtn.innerHTML = '&times;';
            closeBtn.onclick = () => modal.remove();
            
            const title = document.createElement('h3');
            title.textContent = '📝 영상 설명';
            title.style.cssText = `
                margin: 0;
                color: #1A365D;
                font-size: 16px;
                font-weight: bold;
            `;
            
            const videoTitleDiv = document.createElement('div');
            videoTitleDiv.textContent = videoTitle;
            videoTitleDiv.style.cssText = `
                margin-top: 5px;
                font-size: 12px;
                color: #666;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            `;
            
            header.appendChild(closeBtn);
            header.appendChild(title);
            header.appendChild(videoTitleDiv);
            
            // 내용 영역 생성
            const contentArea = document.createElement('div');
            contentArea.style.cssText = `
                max-height: 400px;
                overflow-y: auto;
                background: #D2E9E1;
                padding: 10px;
            `;
            
            if (finalText) {
                const textBox = document.createElement('div');
                textBox.style.cssText = `
                    background: white;
                    border-radius: 6px;
                    padding: 8px;
                    color: black;
                    font-size: 14px;
                    line-height: 1.5;
                    word-wrap: break-word;
                    white-space: pre-wrap;
                    margin: 0;
                `;
                textBox.textContent = finalText;
                contentArea.appendChild(textBox);
            } else {
                const noDesc = document.createElement('div');
                noDesc.style.cssText = `
                    text-align: center;
                    padding: 40px;
                    color: #666;
                `;
                noDesc.innerHTML = `
                    <div style="font-size: 16px; margin-bottom: 8px;">📝</div>
                    <div>설명이 없습니다.</div>
                `;
                contentArea.appendChild(noDesc);
            }
            
            // 버튼 영역 생성
            const buttonArea = document.createElement('div');
            buttonArea.style.cssText = `
                padding: 8px 15px;
                border-top: 1px solid #ccc;
                background: #D2E9E1;
                display: flex;
                gap: 8px;
                justify-content: center;
            `;
            
            if (finalText) {
                const copyBtn = document.createElement('button');
                copyBtn.textContent = '설명복사';
                copyBtn.style.cssText = `
                    background: #FF9800;
                    color: white;
                    border: none;
                    border-radius: 5px;
                    padding: 6px 12px;
                    font-weight: bold;
                    cursor: pointer;
                    width: 80px;
                    font-size: 12px;
                `;
                copyBtn.onclick = () => {
                    if (navigator.clipboard) {
                        navigator.clipboard.writeText(finalText).then(() => {
                            copyBtn.textContent = '복사완료';
                            setTimeout(() => copyBtn.textContent = '설명복사', 1500);
                        });
                    } else {
                        const textarea = document.createElement('textarea');
                        textarea.value = finalText;
                        document.body.appendChild(textarea);
                        textarea.select();
                        document.execCommand('copy');
                        document.body.removeChild(textarea);
                        copyBtn.textContent = '복사완료';
                        setTimeout(() => copyBtn.textContent = '설명복사', 1500);
                    }
                };
                buttonArea.appendChild(copyBtn);
            }
            
            const closeButton = document.createElement('button');
            closeButton.textContent = '닫기';
            closeButton.style.cssText = `
                background: #4a9eff;
                color: white;
                border: none;
                border-radius: 5px;
                padding: 6px 12px;
                font-weight: bold;
                cursor: pointer;
                width: 80px;
                font-size: 12px;
            `;
            closeButton.onclick = () => modal.remove();
            buttonArea.appendChild(closeButton);
            
            // 모달 조립
            content.appendChild(header);
            content.appendChild(contentArea);
            content.appendChild(buttonArea);
            modal.appendChild(content);
            
            // 외부 클릭 이벤트
            modal.onclick = (e) => {
                if (e.target === modal) {
                    modal.remove();
                }
            };
            
            document.body.appendChild(modal);
        }
        
        // 댓글 모달 표시
        async function showCommentsModal(videoId, videoTitle) {
            if (apiKeys.length === 0) {
                alert('API 키가 필요합니다.');
                return;
            }
            
            // 기존 모달 제거
            const existingModal = document.getElementById('commentsModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            try {
                // 백엔드에서 댓글 가져오기
                const result = await callBackendAPI('comments', { 
                    videoId: videoId,
                    maxResults: 20
                });
                
                const comments = result.data || [];
                let commentsHtml = '';
                
                if (comments.length === 0) {
                    commentsHtml = '<div style="text-align: center; padding: 20px; color: #666;">댓글이 없습니다.</div>';
                } else {
                    commentsHtml = comments.map((item, index) => {
                        const comment = item.snippet.topLevelComment.snippet;
                        return `
                            <div style="padding: 10px; border-bottom: 1px solid #eee; background: ${index % 2 === 0 ? '#f9f9f9' : 'white'};">
                                <div style="display: flex; align-items: flex-start; gap: 8px;">
                                    <img src="${comment.authorProfileImageUrl}" style="width: 32px; height: 32px; border-radius: 50%;" onerror="this.style.display='none'">
                                    <div style="flex: 1;">
                                        <div style="font-weight: bold; color: #1976d2; font-size: 12px; margin-bottom: 4px;">${comment.authorDisplayName}</div>
                                        <div style="color: #333; font-size: 13px; line-height: 1.4; word-wrap: break-word;">${comment.textDisplay}</div>
                                        <div style="color: #666; font-size: 11px; margin-top: 4px;">👍 ${comment.likeCount} • ${new Date(comment.publishedAt).toLocaleDateString()}</div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                }
                
                const modalHtml = `
                    <div class="settings-modal" id="commentsModal" style="display: block;">
                        <div class="settings-content" style="max-width: 700px; max-height: 80vh; overflow: hidden; background: white; padding: 0; border-radius: 12px;">
                            <button class="close-btn" onclick="closeCommentsModal()" style="background: #f44336; border-color: #f44336;">&times;</button>
                            <div style="padding: 15px 20px; border-bottom: 1px solid #ddd; background: #f5f5f5;">
                                <h3 style="margin: 0; color: #333; font-size: 16px;">💬 베스트 댓글</h3>
                                <div style="margin-top: 5px; font-size: 12px; color: #666; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${videoTitle}</div>
                            </div>
                            <div style="max-height: 400px; overflow-y: auto;">
                                ${commentsHtml}
                            </div>
                            <div style="padding: 10px 20px; background: #f5f5f5; display: flex; gap: 10px; justify-content: center;">
                                <button onclick="copyAllComments()" style="background: #4caf50; color: white; border: none; border-radius: 5px; padding: 8px 16px; font-weight: bold; cursor: pointer;">모든 댓글 복사</button>
                                <button onclick="closeCommentsModal()" style="background: #666; color: white; border: none; border-radius: 5px; padding: 8px 16px; font-weight: bold; cursor: pointer;">닫기</button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.body.insertAdjacentHTML('beforeend', modalHtml);
                
                // 외부 클릭 시 닫기
                document.getElementById('commentsModal').addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeCommentsModal();
                    }
                });
                
            } catch (error) {
                console.error('댓글 가져오기 오류:', error);
                alert('댓글을 가져오는 중 오류가 발생했습니다: ' + error.message);
            }
        }
        
        // 모든 댓글 복사
        function copyAllComments() {
            const commentsModal = document.getElementById('commentsModal');
            if (!commentsModal) return;
            
            const commentDivs = commentsModal.querySelectorAll('div[style*="word-wrap: break-word"]');
            let allComments = '';
            
            commentDivs.forEach((div, index) => {
                const commentText = div.textContent.trim();
                if (commentText) {
                    allComments += `${index + 1}. ${commentText}\n\n`;
                }
            });
            
            if (navigator.clipboard && window.isSecureContext) {
                navigator.clipboard.writeText(allComments).then(() => {
                    const copyBtn = commentsModal.querySelector('button[onclick="copyAllComments()"]');
                    if (copyBtn) {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = '복사완료';
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                        }, 1500);
                    }
                }).catch(err => {
                    console.error('댓글 복사 실패:', err);
                    fallbackCopyComments(allComments);
                });
            } else {
                fallbackCopyComments(allComments);
            }
        }
        
        function fallbackCopyComments(text) {
            const textArea = document.createElement('textarea');
            textArea.value = text;
            textArea.style.position = 'fixed';
            textArea.style.left = '-999999px';
            textArea.style.top = '-999999px';
            document.body.appendChild(textArea);
            textArea.focus();
            textArea.select();
            
            try {
                const successful = document.execCommand('copy');
                if (successful) {
                    const commentsModal = document.getElementById('commentsModal');
                    const copyBtn = commentsModal?.querySelector('button[onclick="copyAllComments()"]');
                    if (copyBtn) {
                        const originalText = copyBtn.textContent;
                        copyBtn.textContent = '복사완료';
                        setTimeout(() => {
                            copyBtn.textContent = originalText;
                        }, 1500);
                    }
                }
            } catch (err) {
                console.error('Fallback 클립보드 복사 실패:', err);
                alert('클립보드 복사에 실패했습니다.');
            }
            
            document.body.removeChild(textArea);
        }
        
        // 댓글 모달 닫기
        function closeCommentsModal() {
            const modal = document.getElementById('commentsModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // 상세 채널 정보 표시
        async function showDetailedChannelInfo(channelId, channelName) {
            if (!channelId) {
                alert('채널 ID가 없습니다.');
                return;
            }
            
            if (apiKeys.length === 0) {
                alert('먼저 YouTube API 키를 설정해주세요.');
                openSettings();
                return;
            }
            
            try {
                // 로딩 상태 표시
                document.getElementById('statusBar').textContent = `채널 정보 가져오는 중... (${channelName})`;
                
                // 백엔드에서 채널 상세 정보 가져오기
                const result = await callBackendAPI('channel-details', { channelId: channelId });
                
                if (!result.data) {
                    alert('채널 정보를 찾을 수 없습니다.');
                    return;
                }
                
                // 채널 정보 모달 표시
                showDetailedChannelModal(result.data);
                document.getElementById('statusBar').textContent = '채널 정보 로드 완료';
                
            } catch (error) {
                console.error('채널 정보 가져오기 오류:', error);
                alert('채널 정보를 가져오는 중 오류가 발생했습니다: ' + error.message);
                document.getElementById('statusBar').textContent = '채널 정보 로드 실패';
            }
        }
        
        // 상세 채널 모달 표시
        function showDetailedChannelModal(channelData) {
            // 기존 모달 제거
            const existingModal = document.getElementById('detailedChannelModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            const snippet = channelData.snippet;
            const statistics = channelData.statistics;
            const contentDetails = channelData.contentDetails;
            
            const channelId = channelData.id;
            const channelTitle = snippet.title;
            const thumbnailUrl = snippet.thumbnails.high?.url || snippet.thumbnails.default?.url || '';
            const publishedAt = snippet.publishedAt;
            const description = snippet.description || '';
            const customUrl = snippet.customUrl || '';
            const country = snippet.country || 'Unknown';
            
            const subscriberCount = parseInt(statistics.subscriberCount || 0);
            const videoCount = parseInt(statistics.videoCount || 0);
            const viewCount = parseInt(statistics.viewCount || 0);
            
            const uploadsPlaylistId = contentDetails?.relatedPlaylists?.uploads || '';
            
            // 국가명 매핑
            const countryNames = {
                'KR': '대한민국', 'US': '미국', 'JP': '일본', 'CN': '중국', 'GB': '영국',
                'DE': '독일', 'FR': '프랑스', 'CA': '캐나다', 'AU': '호주', 'IN': '인도',
                'BR': '브라질', 'MX': '멕시코', 'IT': '이탈리아', 'ES': '스페인',
                'RU': '러시아', 'NL': '네덜란드', 'SE': '스웨덴', 'NO': '노르웨이',
                'DK': '덴마크', 'FI': '핀란드', 'TH': '태국', 'VN': '베트남',
                'SG': '싱가포르', 'MY': '말레이시아', 'ID': '인도네시아', 'PH': '필리핀',
                'TW': '대만', 'HK': '홍콩', 'Unknown': '알 수 없음'
            };
            const countryName = countryNames[country] || country;
            
            // 계산된 지표들
            const avgViewsPerVideo = videoCount > 0 ? Math.round(viewCount / videoCount) : 0;
            
            // 상세 통계 정보 HTML 생성
            const statsInfoHtml = `
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin-bottom: 15px;">
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">${subscriberCount.toLocaleString()}명</div>
                        <div style="font-size: 10px; color: #666;">구독자 수</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">${videoCount.toLocaleString()}개</div>
                        <div style="font-size: 10px; color: #666;">총 영상 수</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">2025. 4. 4.</div>
                        <div style="font-size: 10px; color: #666;">마지막 업로드</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">${viewCount.toLocaleString()}회</div>
                        <div style="font-size: 10px; color: #666;">총 조회수</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">${avgViewsPerVideo.toLocaleString()}회</div>
                        <div style="font-size: 10px; color: #666;">평균 조회수</div>
                    </div>
                    <div style="background: rgba(255,255,255,0.8); border-radius: 6px; padding: 8px; text-align: center;">
                        <div style="font-size: 14px; font-weight: bold; color: #2c5aa0;">340개</div>
                        <div style="font-size: 10px; color: #666;">평균 좋아요</div>
                    </div>
                </div>
            `;
            
            const modalHtml = `
                <div class="settings-modal" id="detailedChannelModal" style="display: block;">
                    <div class="settings-content" style="max-width: 800px; max-height: 90vh; overflow-y: auto; background: #D2E9E1;">
                        <button class="close-btn" onclick="closeDetailedChannelModal()">&times;</button>
                        
                        <!-- 채널 이미지와 기본 정보 -->
                        <div style="text-align: center; margin-bottom: 15px;">
                            <img src="${thumbnailUrl}" alt="채널 썸네일" 
                                 onclick="window.open('https://www.youtube.com/channel/${channelId}', '_blank')" 
                                 style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover; cursor: pointer; margin-bottom: 10px;">
                            
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <div style="flex: 2;"></div>
                                <h3 onclick="window.open('https://www.youtube.com/channel/${channelId}', '_blank')" 
                                    style="flex: 4; color: #4a9eff; font-size: 20px; font-weight: bold; margin: 0; cursor: pointer; text-align: center;">
                                    ${channelTitle}
                                </h3>
                                <div style="flex: 2; text-align: right; font-size: 12px; color: #666;">
                                    <div>국가: ${countryName}</div>
                                    <div>개설일: ${new Date(publishedAt).getFullYear()}. ${(new Date(publishedAt).getMonth() + 1)}. ${new Date(publishedAt).getDate()}.</div>
                                </div>
                            </div>
                        </div>
                        
                        ${statsInfoHtml}
                        
                        <!-- 채널 설명 -->
                        <div style="background: rgba(255,255,255,0.9); border-radius: 8px; padding: 12px; margin-bottom: 15px;">
                            <h4 style="color: #1A365D; margin: 0 0 8px 0; font-size: 14px; font-weight: bold;">채널 설명</h4>
                            <div style="color: #4A5568; font-size: 12px; line-height: 1.4; max-height: 60px; overflow-y: auto;">
                                ${description || '채널 설명이 없습니다.'}
                            </div>
                        </div>
                        
                        <!-- 버튼 영역 -->
                        <div style="display: flex; gap: 10px; justify-content: center;">
                            <button onclick="collectChannelVideosFromModal('${channelId}', '${channelTitle.replace(/'/g, "&apos;")}', '${uploadsPlaylistId}')" 
                                    style="background: #4CAF50; color: white; border: none; border-radius: 5px; width: 120px; height: 35px; font-weight: bold; cursor: pointer;">
                                채널 영상 수집
                            </button>
                            <button onclick="closeDetailedChannelModal()" 
                                    style="background: #4a9eff; color: white; border: none; border-radius: 5px; width: 120px; height: 35px; font-weight: bold; cursor: pointer;">
                                닫기
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // 상세 채널 모달에서 채널 영상 수집
        async function collectChannelVideosFromModal(channelId, channelTitle, uploadPlaylist) {
            try {
                // 모달 닫기
                closeDetailedChannelModal();
                
                // 로딩 표시
                showLoading(true);
                document.getElementById('statusBar').textContent = `채널 영상 수집 중... (${channelTitle})`;
                
                // 영상 수집 수 가져오기
                const maxResults = document.getElementById('maxResults').value;
                
                // 백엔드에서 채널 영상 가져오기
                const result = await callBackendAPI('channel-videos', { 
                    channelId: channelId,
                    uploadsPlaylistId: uploadPlaylist,
                    maxResults: parseInt(maxResults)
                });
                
                if (result.data.length === 0) {
                    alert('이 채널에서 영상을 찾을 수 없습니다.');
                    showLoading(false);
                    return;
                }
                
                // 결과 표시
                originalResults = result.data;
                currentResults = [...originalResults];
                displayResults(currentResults);
                document.getElementById('statusBar').textContent = `채널 영상 수집 완료 - ${result.data.length}개 영상`;
                
            } catch (error) {
                console.error('채널 영상 수집 오류:', error);
                alert('채널 영상을 수집하는 중 오류가 발생했습니다: ' + error.message);
                document.getElementById('statusBar').textContent = '채널 영상 수집 실패';
                showLoading(false);
            }
        }
        
        // 상세 채널 모달 닫기
        function closeDetailedChannelModal() {
            const modal = document.getElementById('detailedChannelModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // 자막 수집 기능
        async function collectSubtitle(videoId) {
            if (!videoId) {
                alert('비디오 ID가 없습니다.');
                return;
            }
            
            try {
                // 로딩 표시
                const statusBar = document.getElementById('statusBar');
                statusBar.textContent = `자막 수집 중... (${videoId})`;
                
                // 무료 API로 자막 수집
                const response = await fetch(`https://youtube-subtitle-api-omega.vercel.app/api/test?videoId=${videoId}`);
                const data = await response.json();
                
                if (data.error) {
                    alert('자막 수집 오류: ' + data.error);
                    statusBar.textContent = '자막 수집 실패';
                    return;
                }
                
                // 결과 표시
                showSubtitleModal(data);
                statusBar.textContent = '자막 수집 완료';
                
            } catch (error) {
                console.error('자막 수집 오류:', error);
                alert('자막 수집 중 오류가 발생했습니다: ' + error.message);
                document.getElementById('statusBar').textContent = '자막 수집 실패';
            }
        }
        
        // 자막 결과 모달 표시
        function showSubtitleModal(data) {
            // 현재 비디오 ID 저장
            currentVideoId = data.videoId;
            
            // 기존 모달 제거
            const existingModal = document.getElementById('subtitleModal');
            if (existingModal) {
                existingModal.remove();
            }
            
            // 모달 HTML 생성
            const modalHtml = `
                <div class="settings-modal" id="subtitleModal" style="display: block;">
                    <div class="settings-content" style="max-width: 900px; max-height: 85vh; overflow-y: auto;">
                        <button class="close-btn" onclick="closeSubtitleModal()">&times;</button>
                        <h3 style="margin-bottom: 20px; color: #2196F3;">🎤 자막 수집 완료!</h3>
                        
                        <div style="margin-bottom: 20px;">
                            <strong style="color: white; font-size: 16px;">비디오 제목:</strong>
                            <div style="margin-top: 8px; padding: 12px; background: #2a2a2a; border-radius: 6px; color: #fff; font-size: 14px; line-height: 1.4;">${data.videoTitle || data.videoId}</div>
                        </div>
                        
                        <div style="margin-bottom: 15px;">
                            <strong style="color: white; font-size: 16px; margin-bottom: 8px; display: block;">자막 내용:</strong>
                            <textarea readonly id="subtitleTextArea" style="width: 100%; height: 400px; padding: 12px; border: 1px solid #555; border-radius: 6px; background: #1a1a1a; color: white; font-family: 'Consolas', 'Monaco', 'Courier New', monospace; font-size: 13px; resize: vertical; line-height: 1.4;">${data.subtitle || '자막이 없습니다.'}</textarea>
                        </div>
                        
                        <div style="display: flex; gap: 10px; margin-top: 20px; flex-wrap: wrap;">
                            <button class="btn btn-success" onclick="copySubtitle()" style="flex: 1; min-width: 120px;">📋 자막 복사</button>
                            <button class="btn" onclick="downloadSubtitle()" style="background: #FF9800; color: white; flex: 1; min-width: 120px;">📥 TXT 다운로드</button>
                            <button class="btn" onclick="openYouTubeVideo()" style="background: #f44336; color: white; flex: 1; min-width: 120px;">📺 YouTube 열기</button>
                            <button class="btn" onclick="closeSubtitleModal()" style="background: #666; color: white; flex: 1; min-width: 100px;">✖ 닫기</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }
        
        // 자막 복사
        function copySubtitle() {
            const textArea = document.getElementById('subtitleTextArea');
            if (textArea) {
                textArea.select();
                document.execCommand('copy');
                alert('자막이 클립보드에 복사되었습니다!');
            }
        }
        
        // 자막 다운로드
        function downloadSubtitle() {
            const textArea = document.getElementById('subtitleTextArea');
            if (textArea) {
                const blob = new Blob([textArea.value], { type: 'text/plain;charset=utf-8' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `subtitle_${currentVideoId}.txt`;
                link.click();
            }
        }
        
        // YouTube 영상 열기
        function openYouTubeVideo() {
            if (currentVideoId) {
                window.open(`https://www.youtube.com/watch?v=${currentVideoId}`, '_blank');
            }
        }
        
        // 자막 모달 닫기
        function closeSubtitleModal() {
            const modal = document.getElementById('subtitleModal');
            if (modal) {
                modal.remove();
            }
        }
        
        // 초기화 (test.html에서 복사하고 index.html의 인증 초기화 추가)
        document.addEventListener('DOMContentLoaded', async function() {
            // 인증 시스템 초기화
            await initializeAuth();
            
            // 저장된 API 키 로드
            const savedApiKeys = localStorage.getItem('youtubeApiKeys');
            if (savedApiKeys) {
                apiKeys = JSON.parse(savedApiKeys);
            }
            
            // 오늘 날짜 설정
            const today = new Date().toLocaleDateString('sv-SE', {timeZone: 'Asia/Seoul'});
            const endDateField = document.getElementById('endDate');
            const startDateField = document.getElementById('startDate');
            
            endDateField.value = today;
            endDateField.max = today;
            startDateField.max = today;
            
            // 1개월 전 날짜 설정
            const oneMonthAgo = new Date();
            oneMonthAgo.setMonth(oneMonthAgo.getMonth() - 1);
            const startDateStr = oneMonthAgo.toLocaleDateString('sv-SE', {timeZone: 'Asia/Seoul'});
            startDateField.value = startDateStr;
            
            updateDateLimits();
        });
        
        // 페이지 로드 완료 시 초기화
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🚀 YouTube Lens 시작');
            initializeAuth();
        });
    </script>
</body>
</html>
